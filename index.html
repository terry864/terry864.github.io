<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/09/hello-world/" class="article-date">
  <time datetime="2019-06-09T11:41:21.880Z" itemprop="datePublished">2019-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/09/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/09/hello-world/" data-id="cjwpryklh0001ucba7k2kjzmh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Demo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/09/Demo/" class="article-date">
  <time datetime="2019-06-09T00:16:25.000Z" itemprop="datePublished">2019-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hexo操作/">hexo操作</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/09/Demo/">hexo操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>安装完成执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<p>hexo建站</p>
<p>输入以下指令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo  init   blog    #初始化blog文件</span><br><span class="line">cd   blog               #从当前位置移动到blog文件夹</span><br><span class="line"></span><br><span class="line">npm  install           #安装</span><br></pre></td></tr></table></figure>

<p>注意：hexo  init初始化必须是一个空文件夹，上述命令指定在blog文件夹中建站</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo   g              #生成静态文件</span><br><span class="line">hexo   s              #启动服务器，默认情况下，访问网址为： http://localhost:4000/</span><br></pre></td></tr></table></figure>

<p>打开当前网页输入地址：<a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a>   能看到如下外面说明成功了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/09/Demo/" data-id="cjwpryklb0000ucbafr2lb0fs" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo操作/">hexo操作</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-文件上传和下载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/06/文件上传和下载/" class="article-date">
  <time datetime="2019-06-06T00:38:25.000Z" itemprop="datePublished">2019-06-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javaStudyPlan/">javaStudyPlan</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/06/文件上传和下载/">文件上传和下载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="文件上传的概述"><a href="#文件上传的概述" class="headerlink" title="文件上传的概述"></a>文件上传的概述</h3><h4 id="什么是文件上传"><a href="#什么是文件上传" class="headerlink" title="什么是文件上传"></a>什么是文件上传</h4><ul>
<li>文件上传：将本地的文件通过流写入到服务器的过程。</li>
</ul>
<h4 id="为什么要学习文件上传"><a href="#为什么要学习文件上传" class="headerlink" title="为什么要学习文件上传"></a>为什么要学习文件上传</h4><p>实际开发中有很多应用：<br>QQ空间上传图片<br>招聘网站上传简历</p>
<h4 id="文件上传的技术"><a href="#文件上传的技术" class="headerlink" title="文件上传的技术"></a>文件上传的技术</h4><p>JSPSmartUpload ：应用在JSP上的文件上传和下载的组件。<br>FileUpload ：应用在Java环境上的文件上传的功能。<br>Servlet3.0 ：提供文件上传的功能<br>Struts2 ：提供文件上传的功能</p>
<h4 id="文件上传的要素"><a href="#文件上传的要素" class="headerlink" title="文件上传的要素"></a>文件上传的要素</h4><p>文件上传的三个要素<br>表单的提交的方式需要是POST<br>表单中需要有<code>&lt;input type=&quot;file&quot;&gt;</code>元素，需要有name属性和值。<br>表单enctype=”multipart/form-data”</p>
<h3 id="文件上传的原理分析"><a href="#文件上传的原理分析" class="headerlink" title="文件上传的原理分析"></a>文件上传的原理分析</h3><h4 id="抓包分析"><a href="#抓包分析" class="headerlink" title="抓包分析"></a>抓包分析</h4><p>没有设置enctype属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /web06/jsp/upload.jsp HTTP/1.1</span><br><span class="line">Accept: text/html, application/xhtml+xml, */*</span><br><span class="line">X-HttpWatch-RID: 22006-10011</span><br><span class="line">Referer: http://localhost:8080/web06/jsp/upload.jsp</span><br><span class="line">Accept-Language: zh-CN</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0; rv:11.0) like Gecko</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Content-Length: 53</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Cookie: JSESSIONID=D51DCB996556C94861B2C72C4D978010</span><br><span class="line">info=info&amp;upload=C%3A%5CUsers%5Cjt%5CDesktop%5Caa.txt</span><br></pre></td></tr></table></figure>

<p>注意：没有文件上传中的文件的具体的内容。</p>
<p>设置enctype属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /web06/jsp/upload.jsp HTTP/1.1</span><br><span class="line">Accept: text/html, application/xhtml+xml, */*</span><br><span class="line">X-HttpWatch-RID: 22006-10026</span><br><span class="line">Referer: http://localhost:8080/web06/jsp/upload.jsp</span><br><span class="line">Accept-Language: zh-CN</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0; rv:11.0) like Gecko</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------7e139d10110a64</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Content-Length: 322</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Cookie: JSESSIONID=D51DCB996556C94861B2C72C4D978010</span><br><span class="line">-----------------------------7e139d10110a64</span><br><span class="line">Content-Disposition: form-data; name=&quot;info&quot;</span><br><span class="line">aaa</span><br><span class="line">-----------------------------7e139d10110a64</span><br><span class="line">Content-Disposition: form-data; name=&quot;upload&quot;; filename=&quot;C:UsersjtDesktopaa.txt&quot;</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">hello world！！！</span><br><span class="line">-----------------------------7e139d10110a64--</span><br></pre></td></tr></table></figure>

<h4 id="文件上传的原理分析-1"><a href="#文件上传的原理分析-1" class="headerlink" title="文件上传的原理分析`"></a>文件上传的原理分析`</h4><p><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image1.png" alt="image"></p>
<h3 id="文件上传的入门"><a href="#文件上传的入门" class="headerlink" title="文件上传的入门"></a>文件上传的入门</h3><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>第一步：引入文件上传的相关的jar包。<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image2.png" alt="image"><br>第二步：编写文件上传的页面<br>upload.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;文件上传&lt;/h1&gt;</span><br><span class="line">&lt;h3&gt;$&#123; msg &#125;&lt;/h3&gt;</span><br><span class="line">&lt;!-- 文件上传三要素</span><br><span class="line">    * 表单需要是post提交</span><br><span class="line">    * 表单中需要文件上传项，必须有name的属性和值</span><br><span class="line">    * 表单的enctype属性必须是multipart/form-data</span><br><span class="line"> --&gt;</span><br><span class="line"> &lt;form action=<span class="string">"$&#123; pageContext.request.contextPath &#125;/UploadServlet"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">  文件描述:&lt;input type=<span class="string">"text"</span> name=<span class="string">"info"</span>&gt;&lt;br/&gt;</span><br><span class="line">  文件上传:&lt;input type=<span class="string">"file"</span> name=<span class="string">"upload"</span>&gt;&lt;br/&gt;</span><br><span class="line">  &lt;input type=<span class="string">"submit"</span> value=<span class="string">"上传"</span>/&gt;</span><br><span class="line"> &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>编写文件上传的Servlet<br>UploadServlet.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xhchen.upload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * class_name: UploadServlet</span></span><br><span class="line"><span class="comment"> * param: com.xhchen.upload</span></span><br><span class="line"><span class="comment"> * describe:文件上传Servlet</span></span><br><span class="line"><span class="comment"> * creat_user: XHChen</span></span><br><span class="line"><span class="comment"> * creat_date: 2019-06-09</span></span><br><span class="line"><span class="comment"> * creat_time: 15:21</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(name = <span class="string">"UploadServlet"</span>, urlPatterns = <span class="string">"/UploadServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * class_name: UploadServlet</span></span><br><span class="line"><span class="comment">     * param: com.xhchen.upload</span></span><br><span class="line"><span class="comment">     * describe:</span></span><br><span class="line"><span class="comment">     * creat_user: XHChen</span></span><br><span class="line"><span class="comment">     * creat_date: 2019-06-09</span></span><br><span class="line"><span class="comment">     * creat_time: 15:21</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.创建磁盘文件项工厂</span></span><br><span class="line">            DiskFileItemFactory diskFileItemFactory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">            <span class="comment">//2.创建一个核心的解析类</span></span><br><span class="line">            ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(diskFileItemFactory);</span><br><span class="line">            <span class="comment">//3。利用核心类,解析Request，解析后会得到多个部分，返回一个list集合.</span></span><br><span class="line">            <span class="comment">// list 集合装的是每个部分的内容</span></span><br><span class="line">            List&lt;FileItem&gt; list = fileUpload.parseRequest(request);</span><br><span class="line">            <span class="comment">//4.遍历list 集合，会得到代表每个部分的文件项的对象，根据文件项判断是否文件上传项</span></span><br><span class="line">            <span class="keyword">for</span> (FileItem fileItem : list) &#123;</span><br><span class="line">                <span class="comment">//判断这个文件项是否普通项还是文件上传项</span></span><br><span class="line">                <span class="keyword">if</span> (fileItem.isFormField())&#123;</span><br><span class="line">                    <span class="comment">//普通项</span></span><br><span class="line">                    <span class="comment">//接收普通项的值：(接收值不能再使用request，getparameter)</span></span><br><span class="line">                    String Name = fileItem.getFieldName();</span><br><span class="line">                    <span class="comment">//获得普通项的值</span></span><br><span class="line">                    String value = fileItem.getString(<span class="string">"UTF-8"</span>);</span><br><span class="line">                    System.out.println(Name+<span class="string">"----"</span>+value);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//文件上传项</span></span><br><span class="line">                    <span class="comment">//获得文件上传项的文件的名稳健</span></span><br><span class="line">                    String fileName = fileItem.getName();</span><br><span class="line">                    System.out.println(fileName);</span><br><span class="line">                    <span class="comment">//获邓文件上传的文件据</span></span><br><span class="line">                    InputStream is = fileItem.getInputStream();</span><br><span class="line">                    <span class="comment">//获得文件上传的路径：磁盘绝对路径。</span></span><br><span class="line">                    String realPath = getServletContext().getRealPath(<span class="string">""</span>);</span><br><span class="line">                    System.out.println(realPath);</span><br><span class="line">                    <span class="comment">//创建一个输出流，写到入设置的路径中</span></span><br><span class="line">                    OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(realPath + <span class="string">"/"</span> + fileName);</span><br><span class="line">                    <span class="comment">//两个流对接</span></span><br><span class="line">                    <span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                    <span class="keyword">while</span> ((len=is.read())!=-<span class="number">1</span>)&#123;</span><br><span class="line">                       outputStream.write(b,<span class="number">0</span>,len);</span><br><span class="line">                    &#125;</span><br><span class="line">                    is.close();</span><br><span class="line">                    outputStream.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件上传的API"><a href="#文件上传的API" class="headerlink" title="文件上传的API"></a>文件上传的API</h3><h4 id="DiskFileItemFactory：磁盘文件项工厂"><a href="#DiskFileItemFactory：磁盘文件项工厂" class="headerlink" title="DiskFileItemFactory：磁盘文件项工厂"></a>DiskFileItemFactory：磁盘文件项工厂</h4><p>构造方法：<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image5.png" alt="image"><br>DiskFileItemFactory()<br>DiskFileItemFactory(int sizeThreshold,File repostory)</p>
<ul>
<li>sizeThreshold :设置文件上传的缓冲区的大小，默认值为10kb。</li>
<li>repository :设置文件上传过程中产生临时文件存放的路径。<br>方法：<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image6.png" alt="image"></li>
<li>setSizeThreshold() ：设置缓冲区的大小</li>
<li>setRepository() ：设置临时文件存放的路径</li>
</ul>
<h4 id="API的使用的代码"><a href="#API的使用的代码" class="headerlink" title="API的使用的代码"></a>API的使用的代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建磁盘文件项工厂</span></span><br><span class="line">  DiskFileItemFactory diskFileItemFactory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">  <span class="comment">// 1.1设置缓冲区的大小：</span></span><br><span class="line">  diskFileItemFactory.setSizeThreshold(<span class="number">3</span> * <span class="number">1024</span> * <span class="number">1024</span>);<span class="comment">// 设置缓冲区的大小为3M</span></span><br><span class="line">  <span class="comment">// 1.2设置临时文件存放的路径:</span></span><br><span class="line">  <span class="comment">// 获得临时文件存放的路径：</span></span><br><span class="line">  String tempPath = getServletContext().getRealPath(<span class="string">"/temp"</span>);</span><br><span class="line">  diskFileItemFactory.setRepository(<span class="keyword">new</span> File(tempPath));</span><br></pre></td></tr></table></figure>

<h4 id="ServletFileUpload：核心解析类"><a href="#ServletFileUpload：核心解析类" class="headerlink" title="ServletFileUpload：核心解析类"></a>ServletFileUpload：核心解析类</h4><ul>
<li><p>构造方法：<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image8.png" alt="image"></p>
</li>
<li><p>ServeltFileUpload(FileItemFactory fileItemFactory);</p>
</li>
<li><p>方法：<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image9.png" alt="image"></p>
</li>
<li><p>是用来判断表单的enctype属性是否正确。<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image10.png" alt="image"></p>
</li>
<li><p>解析Request对象，返回一个List集合（每个部分的对象FileItem）<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image11.png" alt="image"></p>
</li>
<li><p>设置当个文件的大小<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image12.png" alt="image"></p>
</li>
<li><p>设置上传的文件的总大小<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image13.png" alt="image"></p>
</li>
<li><p>设置中文文件名上传的乱码的问题。<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image14.png" alt="image"></p>
</li>
<li><p>设置监听文件上传的进度</p>
</li>
</ul>
<h3 id="文件上传的API-1"><a href="#文件上传的API-1" class="headerlink" title="文件上传的API`"></a>文件上传的API`</h3><h4 id="FileItem文件项"><a href="#FileItem文件项" class="headerlink" title="FileItem文件项"></a>FileItem文件项</h4><ul>
<li>方法<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image15.png" alt="image"></li>
<li>判断表单项是普通项还是文件上传项。如果为true代表是普通项</li>
<li>普通项的方法：<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image16.png" alt="image"></li>
<li>获得普通项的名称<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image17.png" alt="image"></li>
<li>获得普通项的值</li>
<li>文件上传项：<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image18.png" alt="image"></li>
<li>获得文件上传的文件名的方法<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image19.png" alt="image"></li>
<li>获得文件上传的文件内容的方法<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image20.png" alt="image"></li>
<li>获得文件上传的文件的大小<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image21.png" alt="image"></li>
<li>删除文件上传过程中的临时文件</li>
</ul>
<h3 id="JS控制多文件上传"><a href="#JS控制多文件上传" class="headerlink" title="JS控制多文件上传"></a>JS控制多文件上传</h3><h3 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h3><h4 id="案例需求描述"><a href="#案例需求描述" class="headerlink" title="案例需求描述"></a>案例需求描述</h4><p><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image22.png" alt="image"></p>
<h3 id="案例实现"><a href="#案例实现" class="headerlink" title="案例实现"></a>案例实现</h3><h4 id="案例代码实现"><a href="#案例代码实现" class="headerlink" title="案例代码实现"></a>案例代码实现</h4><p>upload_multi.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">  <span class="function">function <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获得id为div1的元素:</span></span><br><span class="line">    <span class="keyword">var</span> div1Element = document.getElementById(<span class="string">"div1"</span>);</span><br><span class="line">    div1Element.innerHTML += <span class="string">"&lt;div&gt;&lt;input type='file' name='upload'/&gt;&lt;input type='button' value='删除' onclick='del(this)'&gt;&lt;/div&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function">function <span class="title">del</span><span class="params">(who)</span></span>&#123;</span><br><span class="line">    <span class="comment">/* var divv = who.parentNode;</span></span><br><span class="line"><span class="comment">    divv.parentNode.removeChild(divv); */</span></span><br><span class="line">    who.parentNode.parentNode.removeChild(who.parentNode);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;多文件上传&lt;/h1&gt;</span><br><span class="line">&lt;form action=<span class="string">"$&#123; pageContext.request.contextPath &#125;/UploadServlet"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">"button"</span> value=<span class="string">"添加"</span> onclick=<span class="string">"add()"</span>/&gt;</span><br><span class="line">  &lt;input type=<span class="string">"submit"</span> value=<span class="string">"上传"</span>/&gt;&lt;br/&gt;</span><br><span class="line">  &lt;div id=<span class="string">"div1"</span>&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="文件上传兼容浏览器问题及解决"><a href="#文件上传兼容浏览器问题及解决" class="headerlink" title="文件上传兼容浏览器问题及解决"></a>文件上传兼容浏览器问题及解决</h3><h3 id="文件上传兼容浏览器问题"><a href="#文件上传兼容浏览器问题" class="headerlink" title="文件上传兼容浏览器问题"></a>文件上传兼容浏览器问题</h3><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>如果使用IE老版本的浏览器出现一个文件名称获取错误问题。IE老版本获取文件名称的时候，会带有路径。<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image24.png" alt="image"></p>
<h4 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h4><p><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image25.png" alt="image"></p>
<h3 id="文件上传同一个目录下文件同名的问题及解决"><a href="#文件上传同一个目录下文件同名的问题及解决" class="headerlink" title="文件上传同一个目录下文件同名的问题及解决"></a>文件上传同一个目录下文件同名的问题及解决</h3><h3 id="文件上传同一个目录下文件同名问题"><a href="#文件上传同一个目录下文件同名问题" class="headerlink" title="文件上传同一个目录下文件同名问题"></a>文件上传同一个目录下文件同名问题</h3><h4 id="问题描述2"><a href="#问题描述2" class="headerlink" title="问题描述2"></a>问题描述2</h4><p>张三向服务器上传了一个文件aa.txt内容是hello world。李四向服务器上传了一个文件aa.txt内容hello Java。后上传的文件将先上传的文件覆盖了。</p>
<h4 id="问题解决2"><a href="#问题解决2" class="headerlink" title="问题解决2"></a>问题解决2</h4><p>使用唯一文件名进行解决。<br>UploadUtils.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xhchen.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件上传的工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadUtils</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 传递一个文件名，返回一个唯一的文件名。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getUuidFilename</span><span class="params">(String filename)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 在Java的API中有一个类UUID可以产生随机的字符串。aa.txt</span></span><br><span class="line">    <span class="comment">// UUID.randomUUID().toString();</span></span><br><span class="line">    <span class="comment">// 获得文件名的扩展名.</span></span><br><span class="line">    <span class="keyword">int</span> idx = filename.lastIndexOf(<span class="string">"."</span>);</span><br><span class="line">    String extetions = filename.substring(idx);</span><br><span class="line">    <span class="keyword">return</span> UUID.randomUUID().toString().replace(<span class="string">"-"</span>, <span class="string">""</span>)+extetions;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 目录分离的算法实现</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRealPath</span><span class="params">(String uuidFilename)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> code1 = uuidFilename.hashCode();</span><br><span class="line">    <span class="keyword">int</span> d1 = code1 &amp; <span class="number">0xf</span>;</span><br><span class="line">    <span class="keyword">int</span> code2 = code1 &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">int</span> d2 = code2 &amp; <span class="number">0xf</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"/"</span>+d1+<span class="string">"/"</span>+d2;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// System.out.println(UUID.randomUUID().toString().replace("-", ""));</span></span><br><span class="line">    <span class="comment">/*String s = getUuidFilename("aa.txt");</span></span><br><span class="line"><span class="comment">    System.out.println(s);*/</span></span><br><span class="line">    String filename = <span class="string">"185363be735345bf8a971d15332601a3.txt"</span>;</span><br><span class="line">    <span class="keyword">int</span> hashCode = filename.hashCode();</span><br><span class="line">    System.out.println(hashCode);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image26.png" alt="image"></p>
<h3 id="文件上传同一个目录下存放文件过多的问题及解决"><a href="#文件上传同一个目录下存放文件过多的问题及解决" class="headerlink" title="文件上传同一个目录下存放文件过多的问题及解决"></a>文件上传同一个目录下存放文件过多的问题及解决</h3><h3 id="文件上传同一个目录下文件过多的问题"><a href="#文件上传同一个目录下文件过多的问题" class="headerlink" title="文件上传同一个目录下文件过多的问题"></a>文件上传同一个目录下文件过多的问题</h3><h4 id="问题描述3"><a href="#问题描述3" class="headerlink" title="问题描述3"></a>问题描述3</h4><p>现在所有的用户都上传文件，如果网站访问量比较大，如果都上传到同一个目录下，在同一个目录下存放的文件太多了，也会对程序有影响（其实打开该目录的时候，都会很卡，更别说读写操作）。</p>
<h4 id="文件解决"><a href="#文件解决" class="headerlink" title="文件解决"></a>文件解决</h4><p>目录分离<br>按时间分离 ：按月、周、天、小时。<br>按用户分离 ：按张三、李四。<br>按个数分离 ：一个目录下存放3000个文件。<br>按目录分离算法 ：按照某种特定算法进行分离。</p>
<ul>
<li><p>上传一个文件，得到一个唯一的文件名。</p>
</li>
<li><p>唯一文件名获取其hashCode值。—–int类型的值（32位）</p>
</li>
<li><p>让hashCode的值 &amp; 0xf;—–得出的这个值作为一级目录。</p>
</li>
<li><p>让hashCode右移4位 &amp; 0xf;—-得出的这个值作为二级目录。</p>
</li>
<li><p>以此类推。</p>
</li>
<li><p>分析算法：<br><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image27.png" alt="image"></p>
</li>
</ul>
<h4 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 目录分离的算法实现</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRealPath</span><span class="params">(String uuidFilename)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> code1 = uuidFilename.hashCode();</span><br><span class="line">    <span class="keyword">int</span> d1 = code1 &amp; <span class="number">0xf</span>;</span><br><span class="line">    <span class="keyword">int</span> code2 = code1 &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">int</span> d2 = code2 &amp; <span class="number">0xf</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"/"</span>+d1+<span class="string">"/"</span>+d2;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件下载的概述"><a href="#文件下载的概述" class="headerlink" title="文件下载的概述"></a>文件下载的概述</h3><h4 id="什么是文件下载"><a href="#什么是文件下载" class="headerlink" title="什么是文件下载"></a>什么是文件下载</h4><ul>
<li>文件下载：将服务器上的一个文件，通过流写入到客户端上。</li>
</ul>
<h4 id="为什么学习文件下载"><a href="#为什么学习文件下载" class="headerlink" title="为什么学习文件下载"></a>为什么学习文件下载</h4><ul>
<li>很多应用包含有文件下载的功能<ul>
<li>音乐的下载</li>
<li>应用的下载</li>
</ul>
</li>
</ul>
<h4 id="文件下载的方式"><a href="#文件下载的方式" class="headerlink" title="文件下载的方式"></a>文件下载的方式</h4><ul>
<li>使用超链接的方式实现文件的下载<ul>
<li>在<code>&lt;a href=&quot;文件的路径&quot;&gt;超链接&lt;/a&gt;</code></li>
<li>注意：超链接的方式，如果浏览器不能识别这种格式的文件，提示下载，如果支持该格式的文件，直接打开。</li>
</ul>
</li>
<li>通过手动编写代码的方式实现文件的下载<ul>
<li>设置两个头和一个流</li>
<li>Content-Type :文件的MIME的类型</li>
<li>Content-Disposition :浏览器支持该格式的文件，提示下载</li>
<li>设置代表该文件的输入流(输出流是固定 response.getOutputStream())</li>
</ul>
</li>
</ul>
<h3 id="文件下载的入门之超链接的方式"><a href="#文件下载的入门之超链接的方式" class="headerlink" title="文件下载的入门之超链接的方式"></a>文件下载的入门之超链接的方式</h3><h3 id="超链接方式实现文件下载"><a href="#超链接方式实现文件下载" class="headerlink" title="超链接方式实现文件下载"></a>超链接方式实现文件下载</h3><h4 id="代码实现3"><a href="#代码实现3" class="headerlink" title="代码实现3"></a>代码实现3</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;文件下载：超链接的方式&lt;/h1&gt;</span><br><span class="line">&lt;h3&gt;&lt;a href="$&#123; pageContext.request.contextPath &#125;/download/1.jpg"&gt;1.jpg&lt;/a&gt;&lt;/h3&gt;</span><br><span class="line">&lt;h3&gt;&lt;a href="$&#123; pageContext.request.contextPath &#125;/download/aa.zip"&gt;aa.zip&lt;/a&gt;&lt;/h3&gt;</span><br></pre></td></tr></table></figure>

<p>如果浏览器支持这个格式的文件就会直接打开，如果浏览器不支持这个格式的文件才会提示下载。</p>
<h3 id="文件下载的入门之手动编码的方式"><a href="#文件下载的入门之手动编码的方式" class="headerlink" title="文件下载的入门之手动编码的方式"></a>文件下载的入门之手动编码的方式</h3><h3 id="手动编码的方式实现文件下载"><a href="#手动编码的方式实现文件下载" class="headerlink" title="手动编码的方式实现文件下载"></a>手动编码的方式实现文件下载</h3><h4 id="代码实现4"><a href="#代码实现4" class="headerlink" title="代码实现4"></a>代码实现4</h4><p>文件下载的页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;文件下载：手动编码的方式&lt;/h1&gt;</span><br><span class="line">&lt;h3&gt;&lt;a href="$&#123; pageContext.request.contextPath &#125;/DownloadServlet?filename=1.jpg"&gt;1.jpg&lt;/a&gt;&lt;/h3&gt;</span><br><span class="line">&lt;h3&gt;&lt;a href="$&#123; pageContext.request.contextPath &#125;/DownloadServlet?filename=aa.zip"&gt;aa.zip&lt;/a&gt;&lt;/h3&gt;</span><br><span class="line">&lt;h3&gt;&lt;a href="$&#123; pageContext.request.contextPath &#125;/DownloadServlet?filename=美女.jpg"&gt;美女.jpg&lt;/a&gt;&lt;/h3&gt;</span><br></pre></td></tr></table></figure>

<p>文件下载的Servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xhchen.download;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xhchen.utils.DownloadUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件下载的Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 1.接收参数：</span></span><br><span class="line">    String filename = <span class="keyword">new</span> String(request.getParameter(<span class="string">"filename"</span>).getBytes(<span class="string">"ISO-8859-1"</span>),<span class="string">"UTF-8"</span>);</span><br><span class="line">    <span class="comment">// 2.下载：设置两个头和一个流</span></span><br><span class="line">    <span class="comment">// 设置Content-Type</span></span><br><span class="line">    String type = getServletContext().getMimeType(filename);</span><br><span class="line">    response.setContentType(type);</span><br><span class="line">    <span class="comment">// 定义一个代表该文件的路径：</span></span><br><span class="line">    String path = getServletContext().getRealPath(<span class="string">"/download"</span>);</span><br><span class="line">    File file = <span class="keyword">new</span> File(path+<span class="string">"/"</span>+filename);</span><br><span class="line">    <span class="comment">// 判断浏览器的类型:</span></span><br><span class="line">    String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">    <span class="keyword">if</span>(agent.contains(<span class="string">"Firefox"</span>))&#123;</span><br><span class="line">      <span class="comment">// 使用的是Firefox</span></span><br><span class="line">      filename = DownloadUtils.base64EncodeFileName(filename);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">// IE或者其他的浏览器</span></span><br><span class="line">      filename = URLEncoder.encode(filename, <span class="string">"UTF-8"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置Content-Disposition</span></span><br><span class="line">    response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+filename);</span><br><span class="line">    <span class="comment">// 设置一个代表了文件的输入流</span></span><br><span class="line">    InputStream is = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">    OutputStream os = response.getOutputStream();</span><br><span class="line">    <span class="comment">// 两个流对接：</span></span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span>((len = is.read(b))!=-<span class="number">1</span>)&#123;</span><br><span class="line">      os.write(b, <span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line">    is.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    doGet(request, response);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="中文文件的下载"><a href="#中文文件的下载" class="headerlink" title="中文文件的下载"></a>中文文件的下载</h3><h4 id="代码实现5"><a href="#代码实现5" class="headerlink" title="代码实现5"></a>代码实现5</h4><ul>
<li>中文文件的下载：（出现乱码问题）<ul>
<li>不同的浏览器对中文文件的下载的编码不一样的。</li>
<li>IE浏览器采用的是URL编码</li>
<li>Firefox浏览器采用的是Base64编码</li>
<li>判断客户端使用的浏览器的类型</li>
<li>User-Agent请求头可以获得客户端浏览器信息。</li>
</ul>
</li>
<li>代码实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个代表该文件的路径：</span></span><br><span class="line">    String path = getServletContext().getRealPath(<span class="string">"/download"</span>);</span><br><span class="line">    File file = <span class="keyword">new</span> File(path+<span class="string">"/"</span>+filename);</span><br><span class="line">    <span class="comment">// 判断浏览器的类型:</span></span><br><span class="line">    String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">    <span class="keyword">if</span>(agent.contains(<span class="string">"Firefox"</span>))&#123;</span><br><span class="line">      <span class="comment">// 使用的是Firefox</span></span><br><span class="line">      filename = DownloadUtils.base64EncodeFileName(filename);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">// IE或者其他的浏览器</span></span><br><span class="line">      filename = URLEncoder.encode(filename, <span class="string">"UTF-8"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="给定目录下的文件下载之分析"><a href="#给定目录下的文件下载之分析" class="headerlink" title="给定目录下的文件下载之分析"></a>给定目录下的文件下载之分析</h3><h3 id="案例需求-1"><a href="#案例需求-1" class="headerlink" title="案例需求-"></a>案例需求-</h3><h4 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h4><p>给定一个目录（这个目录可以是任意盘符下的任意路径—这个路径下有多少级目录，每级目录中有多少个文件都是未知的）。将这个路径中的文件显示到页面上，在页面上给每个问题件都提供响应下载的链接，当点击这个链接的时候，对该文件进行下载。</p>
<h3 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h3><h4 id="分析过程"><a href="#分析过程" class="headerlink" title="分析过程"></a>分析过程</h4><p><img src="%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/image33.png" alt="image"></p>
<h3 id="给定目录下的文件下载之文件列表显示"><a href="#给定目录下的文件下载之文件列表显示" class="headerlink" title="给定目录下的文件下载之文件列表显示"></a>给定目录下的文件下载之文件列表显示</h3><h3 id="文件列表显示"><a href="#文件列表显示" class="headerlink" title="文件列表显示"></a>文件列表显示</h3><h4 id="代码实现7"><a href="#代码实现7" class="headerlink" title="代码实现7"></a>代码实现7</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.io.File"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;树形遍历&lt;/h1&gt;</span><br><span class="line">&lt;%</span><br><span class="line">  <span class="comment">// 1.创建一个队列：</span></span><br><span class="line">  Queue&lt;File&gt; queue = <span class="keyword">new</span> LinkedList&lt;File&gt;();</span><br><span class="line">  <span class="comment">// 2.先将跟节点入队：</span></span><br><span class="line">  File root = <span class="keyword">new</span> File(<span class="string">"E://resource"</span>);</span><br><span class="line">  queue.offer(root);</span><br><span class="line">  <span class="comment">// 判断这个队列是否为空，不为空需要进行遍历:</span></span><br><span class="line">  <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">    <span class="comment">// 将跟节点出队:</span></span><br><span class="line">    File file = queue.poll();</span><br><span class="line">    <span class="comment">// 获得跟节点下的所有子节点:</span></span><br><span class="line">    File[] files = file.listFiles();</span><br><span class="line">    <span class="comment">// 遍历所有子节点:</span></span><br><span class="line">    <span class="keyword">for</span>(File f:files)&#123;</span><br><span class="line">      <span class="comment">// 判断该节点是否为叶子节点:</span></span><br><span class="line">      <span class="keyword">if</span>(f.isFile())&#123;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;h4&gt;&lt;a href="$&#123; pageContext.request.contextPath &#125;/DownloadListServlet?filename=&lt;%=f.getCanonicalPath()%&gt;"&gt;&lt;%= f.getName() %&gt;&lt;/a&gt;&lt;/h4&gt;</span><br><span class="line">&lt;%</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        queue.offer(f);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="给定目录下的文件下载之下载代码实现"><a href="#给定目录下的文件下载之下载代码实现" class="headerlink" title="给定目录下的文件下载之下载代码实现"></a>给定目录下的文件下载之下载代码实现</h3><h3 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h3><h4 id="代码实现6"><a href="#代码实现6" class="headerlink" title="代码实现6"></a>代码实现6</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xhchen.download;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xhchen.utils.DownloadUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 树形的文件下载的代码实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 接收参数:</span></span><br><span class="line">    String path = request.getParameter(<span class="string">"filename"</span>);</span><br><span class="line">    <span class="keyword">if</span>(path != <span class="keyword">null</span>)&#123;</span><br><span class="line">      path = <span class="keyword">new</span> String(path.getBytes(<span class="string">"ISO-8859-1"</span>),<span class="string">"UTF-8"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    File file = <span class="keyword">new</span> File(path);</span><br><span class="line">    <span class="comment">// 实现文件下载:设置两个头和一个流:</span></span><br><span class="line">    <span class="comment">// 获得文件名</span></span><br><span class="line">    String filename = file.getName();</span><br><span class="line">    response.setContentType(getServletContext().getMimeType(filename));</span><br><span class="line">    <span class="comment">// 设置另一个头：</span></span><br><span class="line">    String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">    <span class="keyword">if</span>(agent.contains(<span class="string">"Firefox"</span>))&#123;</span><br><span class="line">      filename = DownloadUtils.base64EncodeFileName(filename);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      filename = URLEncoder.encode(filename, <span class="string">"UTF-8"</span>);</span><br><span class="line">      filename = filename.replace(<span class="string">"+"</span>, <span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+filename);</span><br><span class="line">    <span class="comment">// 设置输入流:</span></span><br><span class="line">    InputStream is = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">    OutputStream os = response.getOutputStream();</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span>((len = is.read(b))!=-<span class="number">1</span>)&#123;</span><br><span class="line">      os.write(b, <span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line">    is.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    doGet(request, response);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/06/文件上传和下载/" data-id="cjwprykm70006ucba46vcvnlj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/文件上传和下载/">文件上传和下载</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/hexo操作/">hexo操作</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javaStudyPlan/">javaStudyPlan</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo操作/">hexo操作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件上传和下载/">文件上传和下载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/hexo操作/" style="font-size: 10px;">hexo操作</a> <a href="/tags/文件上传和下载/" style="font-size: 10px;">文件上传和下载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/09/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/06/09/Demo/">hexo操作</a>
          </li>
        
          <li>
            <a href="/2019/06/06/文件上传和下载/">文件上传和下载</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>